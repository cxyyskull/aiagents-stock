# 主力选股批量分析历史记录功能说明

## 📋 功能概述

主力选股批量分析历史记录功能可以自动保存每次批量分析的完整结果，方便用户：
- 查看历史分析记录
- 对比不同时间的分析结果
- 重新加载历史结果进行查看
- 统计分析成功率和耗时

## ✨ 核心功能

### 1. 自动保存
- ✅ 批量分析完成后自动保存到数据库
- ✅ 保存完整的分析结果（包括成功和失败的股票）
- ✅ 记录分析时间、模式、耗时等元数据
- ✅ 不影响用户操作，后台静默保存

### 2. 历史记录查看
- ✅ 可查看最近50条批量分析记录
- ✅ 显示每条记录的详细信息
- ✅ 支持展开查看完整分析报告
- ✅ 按时间倒序排列，最新的在最前

### 3. 统计数据
- ✅ 总记录数
- ✅ 分析股票总数
- ✅ 成功分析数量
- ✅ 成功率统计
- ✅ 平均耗时

### 4. 记录管理
- ✅ 删除不需要的历史记录
- ✅ 重新加载历史结果到当前页面
- ✅ 查看成功和失败的股票明细

## 🚀 使用指南

### 步骤1：执行批量分析

1. 进入主力选股页面
2. 完成主力选股分析，获取候选列表
3. 点击"🚀 开始批量分析"
4. 选择分析数量和模式
5. 等待分析完成

**自动保存**：分析完成后，系统会自动将结果保存到历史记录数据库。

### 步骤2：查看历史记录

1. 在主力选股页面，点击右上角的"📚 批量分析历史"按钮
2. 进入历史记录页面

### 步骤3：查看统计信息

页面顶部显示统计指标：
- **总记录数**：累计批量分析次数
- **分析股票总数**：累计分析的股票数量
- **成功分析**：成功分析的股票总数
- **成功率**：分析成功率百分比
- **平均耗时**：每次批量分析的平均耗时

### 步骤4：查看具体记录

每条记录显示：

**基本信息**：
- 分析时间
- 分析模式（顺序/并行）
- 分析数量
- 总耗时

**统计指标**：
- 成功数量
- 失败数量
- 成功率
- 平均单股耗时

**成功的股票**：
- 代码、名称
- 投资评级
- 信心度
- 进场区间、止盈位、止损位
- 完整的分析报告（可展开）

**失败的股票**：
- 代码
- 失败原因

### 步骤5：管理记录

**删除记录**：
- 点击"🗑️ 删除此记录"按钮
- 确认后删除

**重新加载**：
- 点击"🔄 加载到当前结果"按钮
- 历史结果将加载到主页面
- 返回主页即可查看

## 📊 数据存储

### 数据库文件
- **文件名**：`main_force_batch.db`
- **位置**：项目根目录
- **类型**：SQLite数据库

### 存储内容
每条记录包含：
- `id`：记录ID
- `analysis_date`：分析时间
- `batch_count`：分析数量
- `analysis_mode`：分析模式
- `success_count`：成功数量
- `failed_count`：失败数量
- `total_time`：总耗时
- `results_json`：完整结果（JSON格式）
- `created_at`：创建时间

### 数据大小
- 单条记录约 50-200KB（取决于分析结果详细程度）
- 50条记录约 2.5-10MB
- 建议定期清理不需要的历史记录

## 💡 使用技巧

### 1. 对比分析
- 可以对比不同时间的批量分析结果
- 观察主力资金流向的变化趋势
- 识别持续受主力青睐的股票

### 2. 成功率分析
- 通过成功率判断市场环境
- 成功率低可能意味着市场波动大或数据质量问题
- 成功率高说明分析稳定可靠

### 3. 耗时优化
- 对比顺序和并行模式的耗时
- 根据实际情况选择合适的分析模式
- 监控耗时变化，发现性能问题

### 4. 结果复用
- 重新加载历史结果避免重复分析
- 特别适合短时间内需要多次查看的场景
- 节省API调用和分析时间

## ⚠️ 注意事项

1. **存储空间**
   - 历史记录会占用磁盘空间
   - 建议定期清理不需要的记录
   - 当前限制显示最近50条

2. **数据一致性**
   - 删除记录后无法恢复
   - 删除前请确认不再需要

3. **性能影响**
   - 保存历史记录对分析性能影响很小（<1秒）
   - 查看历史记录响应快速

4. **数据安全**
   - 数据库文件存储在本地
   - 建议定期备份 `main_force_batch.db` 文件
   - 不要删除正在使用的数据库文件

## 🔧 故障排查

### 保存失败
**现象**：批量分析完成后，历史记录中没有新记录

**解决方法**：
1. 查看终端日志，检查是否有错误信息
2. 确认 `main_force_batch.db` 文件有写入权限
3. 检查磁盘空间是否充足

### 历史记录显示错误
**现象**：点击"批量分析历史"后显示错误

**解决方法**：
1. 检查 `main_force_batch.db` 文件是否存在
2. 尝试删除数据库文件，让系统重新创建
3. 查看错误详情，根据提示修复

### 加载历史结果失败
**现象**：点击"加载到当前结果"后没有反应

**解决方法**：
1. 刷新页面重试
2. 检查结果数据是否完整
3. 重新执行一次批量分析

## 📚 相关文档

- [主力选股批量分析功能说明.md](主力选股批量分析功能说明.md) - 批量分析功能说明
- [主力选股使用指南.md](主力选股使用指南.md) - 主力选股完整指南

## 🎯 使用场景

### 场景1：趋势追踪
```
周一批量分析TOP30 → 保存结果 → 
周三批量分析TOP30 → 保存结果 → 
周五对比两次结果 → 识别趋势
```

### 场景2：策略验证
```
使用不同参数批量分析 → 保存多个结果 → 
对比成功率和推荐股票 → 优化筛选策略
```

### 场景3：决策支持
```
批量分析并保存 → 实盘操作 → 
一周后查看历史记录 → 验证分析准确性
```

---

**让历史记录成为您的投资助手！** 📊

