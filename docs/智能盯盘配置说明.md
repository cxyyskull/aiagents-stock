# 智能盯盘 - 配置说明

## 📋 配置概览

智能盯盘使用主程序的**统一配置管理系统**，与其他功能模块共享配置。所有配置项通过主程序的 **"环境配置"** 页面进行管理。

---

## 🔧 配置项说明

### 1. 🤖 DeepSeek AI配置（必需）

智能盯盘的AI决策引擎，用于分析市场数据并做出交易决策。

| 配置项 | 环境变量 | 说明 | 是否必需 |
|--------|---------|------|---------|
| DeepSeek API Key | `DEEPSEEK_API_KEY` | DeepSeek API密钥 | ✅ 是 |
| DeepSeek API地址 | `DEEPSEEK_BASE_URL` | API服务地址（默认官方） | ❌ 否 |

**获取方式：**
1. 访问 [DeepSeek官网](https://platform.deepseek.com/)
2. 注册账号并创建API密钥
3. 在主程序"环境配置"中填入

---

### 2. 🔌 MiniQMT配置（可选）

用于实盘交易，如不配置则使用模拟交易。

| 配置项 | 环境变量 | 说明 | 默认值 |
|--------|---------|------|--------|
| 启用MiniQMT | `MINIQMT_ENABLED` | 是否启用实盘交易 | `false` |
| MiniQMT账户ID | `MINIQMT_ACCOUNT_ID` | QMT交易账户ID | 无 |
| MiniQMT服务器 | `MINIQMT_HOST` | QMT服务地址 | `127.0.0.1` |
| MiniQMT端口 | `MINIQMT_PORT` | QMT服务端口 | `58610` |

**说明：**
- `MINIQMT_ENABLED=false`: 使用模拟交易（安全，推荐新手）
- `MINIQMT_ENABLED=true`: 使用实盘交易（需要miniQMT环境）

**实盘交易要求：**
1. 已安装并运行miniQMT客户端
2. 已配置交易账户
3. 账户有足够资金和权限
4. 详见：`docs/MINIQMT_INTEGRATION_GUIDE.md`

---

### 3. 📧 邮件通知配置（可选）

用于接收交易决策和执行结果的邮件通知。

| 配置项 | 环境变量 | 说明 | 示例 |
|--------|---------|------|------|
| 启用邮件通知 | `EMAIL_ENABLED` | 是否启用邮件 | `true` |
| SMTP服务器 | `SMTP_SERVER` | 邮件服务器地址 | `smtp.qq.com` |
| SMTP端口 | `SMTP_PORT` | 邮件服务器端口 | `587` |
| 发件人邮箱 | `EMAIL_FROM` | 发送邮件的邮箱 | `your@qq.com` |
| 邮箱授权码 | `EMAIL_PASSWORD` | SMTP授权码 | `xxx` |
| 收件人邮箱 | `EMAIL_TO` | 接收通知的邮箱 | `notify@qq.com` |

**配置参考：**
- 详见：`docs/邮件配置指南.md`

---

### 4. 🔔 Webhook通知配置（可选）

支持钉钉、飞书机器人推送交易通知。

| 配置项 | 环境变量 | 说明 | 示例 |
|--------|---------|------|------|
| 启用Webhook | `WEBHOOK_ENABLED` | 是否启用Webhook | `true` |
| Webhook类型 | `WEBHOOK_TYPE` | `dingtalk`或`feishu` | `dingtalk` |
| Webhook地址 | `WEBHOOK_URL` | 机器人Webhook URL | `https://...` |
| 自定义关键词 | `WEBHOOK_KEYWORD` | 钉钉安全验证关键词 | `aiagents通知` |

**配置参考：**
- 钉钉：`docs/Webhook钉钉关键词快速配置指南.md`
- 飞书：`docs/Webhook通知配置指南.md`

---

## 🚀 配置步骤

### 步骤1: 打开环境配置

在主程序左侧菜单中，点击 **"环境配置"** 按钮。

### 步骤2: 填写必需配置

至少需要配置：
- ✅ **DeepSeek API Key** （必需）
- 其他配置项可选

### 步骤3: 保存配置

点击 **"保存配置"** 按钮，配置将保存到 `.env` 文件。

### 步骤4: 验证配置

1. 返回 **"智能盯盘"** 页面
2. 点击 **"系统设置"** 标签
3. 查看配置状态是否正常

### 步骤5: 刷新页面

如果修改了配置：
- 点击 **"重新加载配置"** 按钮
- 或按 `Ctrl+R` 刷新浏览器

---

## 📊 配置示例

### 最小配置（仅AI决策 + 模拟交易）

```env
# DeepSeek AI（必需）
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxx"

# 其他默认值
MINIQMT_ENABLED="false"  # 使用模拟交易
EMAIL_ENABLED="false"    # 不发送邮件
WEBHOOK_ENABLED="false"  # 不发送Webhook
```

### 完整配置（实盘 + 通知）

```env
# DeepSeek AI
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxx"
DEEPSEEK_BASE_URL="https://api.deepseek.com/v1"

# MiniQMT实盘交易
MINIQMT_ENABLED="true"
MINIQMT_ACCOUNT_ID="888888888"
MINIQMT_HOST="127.0.0.1"
MINIQMT_PORT="58610"

# 邮件通知
EMAIL_ENABLED="true"
SMTP_SERVER="smtp.qq.com"
SMTP_PORT="587"
EMAIL_FROM="yourmail@qq.com"
EMAIL_PASSWORD="smtp_auth_code"
EMAIL_TO="notify@qq.com"

# 钉钉通知
WEBHOOK_ENABLED="true"
WEBHOOK_TYPE="dingtalk"
WEBHOOK_URL="https://oapi.dingtalk.com/robot/send?access_token=xxx"
WEBHOOK_KEYWORD="aiagents通知"
```

---

## ⚠️ 注意事项

### 1. 配置安全
- ❌ 不要将 `.env` 文件提交到版本控制
- ✅ API Key和密码要妥善保管
- ✅ 定期更换重要凭证

### 2. 实盘交易风险
- ⚠️ 首次使用建议用模拟模式测试
- ⚠️ 实盘交易有资金风险，谨慎操作
- ⚠️ 建议设置合理的止损止盈参数

### 3. 配置变更
- 修改配置后需要重新加载或重启程序
- 部分配置（如miniQMT连接）可能需要重启服务

### 4. 通知频率
- 实时监控会产生较多通知
- 建议根据需要开启/关闭通知渠道
- 可以通过监控频率控制通知数量

---

## 🔍 故障排查

### 问题1: DeepSeek API调用失败

**症状：** 分析时提示API错误

**解决：**
1. 检查API Key是否正确
2. 检查网络连接
3. 检查API额度是否充足
4. 查看 `logs/` 目录下的日志

### 问题2: miniQMT连接失败

**症状：** 提示miniQMT连接失败

**解决：**
1. 确认miniQMT客户端已运行
2. 检查账户ID是否正确
3. 检查服务地址和端口
4. 查看miniQMT客户端状态

### 问题3: 邮件发送失败

**症状：** 通知未收到邮件

**解决：**
1. 检查SMTP配置是否正确
2. 确认使用授权码而非密码
3. 检查邮件服务器端口（587/465）
4. 查看日志中的错误信息

### 问题4: Webhook通知失败

**症状：** 钉钉/飞书未收到消息

**解决：**
1. 检查Webhook URL是否正确
2. 钉钉需要配置自定义关键词
3. 测试Webhook是否可访问
4. 检查机器人是否被禁用

---

## 📚 相关文档

- [智能盯盘快速测试](./智能盯盘快速测试.md)
- [智能盯盘集成说明](./智能盯盘集成说明.md)
- [MiniQMT集成指南](./MINIQMT_INTEGRATION_GUIDE.md)
- [邮件配置指南](./邮件配置指南.md)
- [Webhook通知配置指南](./Webhook通知配置指南.md)
- [环境配置快速指南](./环境配置快速指南.md)

---

## 💡 最佳实践

1. **循序渐进**
   - 先用最小配置（仅DeepSeek + 模拟交易）测试
   - 验证AI决策逻辑后再启用实盘
   - 逐步开启通知功能

2. **风险控制**
   - 设置合理的仓位比例（建议≤30%）
   - 设置止损止盈参数
   - 小资金测试后再加大投入

3. **监控管理**
   - 定期查看决策历史
   - 分析AI决策准确率
   - 根据效果调整策略

4. **配置备份**
   - 定期备份 `.env` 文件
   - 记录重要配置参数
   - 测试环境与生产环境分离

---

**更新时间：** 2025-10-25
**版本：** v1.0

