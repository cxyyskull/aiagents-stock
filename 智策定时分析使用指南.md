# 智策定时分析使用指南

## 📋 功能概述

智策定时分析功能允许您设置每天固定时间自动运行板块策略分析，并将核心分析结果通过邮件发送到指定邮箱。

## ⚙️ 配置要求

### 1. 邮件配置（必需）

在 `.env` 文件中添加以下配置：

```bash
# 邮件通知配置
EMAIL_ENABLED=true
SMTP_SERVER=smtp.example.com
SMTP_PORT=587
EMAIL_FROM=your-email@example.com
EMAIL_PASSWORD=your-email-password
EMAIL_TO=recipient@example.com
```

### 2. 配置说明

| 配置项 | 说明 | 示例 |
|--------|------|------|
| EMAIL_ENABLED | 是否启用邮件（true/false） | true |
| SMTP_SERVER | SMTP服务器地址 | smtp.qq.com |
| SMTP_PORT | SMTP端口（通常587或465） | 587 |
| EMAIL_FROM | 发件人邮箱 | your@qq.com |
| EMAIL_PASSWORD | 邮箱密码或授权码 | xxxx xxxx xxxx |
| EMAIL_TO | 收件人邮箱（可多个，逗号分隔） | email1@qq.com,email2@gmail.com |

### 3. 常见邮箱SMTP配置

#### QQ邮箱
```bash
SMTP_SERVER=smtp.qq.com
SMTP_PORT=587
EMAIL_FROM=your@qq.com
EMAIL_PASSWORD=授权码（不是QQ密码）
```

**获取QQ邮箱授权码：**
1. 登录QQ邮箱网页版
2. 设置 → 账户
3. 开启 "POP3/SMTP服务"
4. 生成授权码

#### 163邮箱
```bash
SMTP_SERVER=smtp.163.com
SMTP_PORT=587
EMAIL_FROM=your@163.com
EMAIL_PASSWORD=授权码
```

#### Gmail
```bash
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
EMAIL_FROM=your@gmail.com
EMAIL_PASSWORD=应用专用密码
```

#### 企业邮箱
根据企业邮箱提供商的SMTP配置填写

## 🚀 使用步骤

### 1. 配置邮件

编辑项目根目录的 `.env` 文件，添加上述邮件配置。

### 2. 进入智策板块

在侧边栏点击 **"🎯 智策板块"** 按钮

### 3. 展开定时设置

点击 **"⏰ 定时分析设置"** 展开器

### 4. 检查邮件配置

查看底部的 **"📧 邮件配置检查"** 区域：
- ✅ 所有配置项都显示绿色勾号 → 配置正确
- ❌ 有红色叉号 → 需要补充配置

### 5. 测试邮件

点击 **"📧 测试邮件"** 按钮：
- 系统会发送一封测试邮件
- 检查收件箱是否收到
- 如果收到，说明配置正确

### 6. 设置定时时间

使用时间选择器设置每天运行的时间：
- 默认：09:00（上午9点）
- 建议：盘前（8:00-9:00）或盘后（15:30-17:00）

### 7. 启动定时任务

点击 **"▶️ 启动"** 按钮：
- 系统显示 "✅ 定时任务运行中"
- 显示下次运行时间

### 8. 等待自动运行

系统会在每天指定时间自动：
1. 获取最新市场数据
2. 运行AI智能体分析
3. 生成板块预测
4. 发送邮件到指定邮箱

### 9. 查看邮件报告

邮件包含：
- 📋 板块多空预测
- 🔄 板块轮动预测
- 🔥 板块热度排行
- 📊 策略总结

## 💡 功能按钮说明

### ▶️ 启动
- 功能：启动定时任务
- 状态：定时任务未运行时可用
- 效果：每天定时运行分析并发送邮件

### ⏹️ 停止
- 功能：停止定时任务
- 状态：定时任务运行中时可用
- 效果：取消定时分析

### 🔄 立即运行
- 功能：手动触发一次分析
- 状态：随时可用
- 效果：立即运行分析并发送邮件（不影响定时任务）

### 📧 测试邮件
- 功能：发送测试邮件
- 状态：随时可用
- 效果：验证邮件配置是否正确

## 📧 邮件内容

### 邮件主题
```
智策板块分析报告 - 2024-01-15 09:00:00
```

### 邮件正文结构

```
============================================================
智策板块策略分析报告
============================================================
分析时间: 2024-01-15 09:00:00
AI模型: DeepSeek Multi-Agent System

============================================================
一、板块多空预测
============================================================

【看多板块】

1. 电子 (信心度: 8/10)
   理由: 政策支持，资金持续流入
   风险: 估值偏高，注意回调风险

2. ...

【看空板块】
...

============================================================
二、板块轮动预测
============================================================

【当前强势板块】
...

【潜力接力板块】⭐ 重点关注
...

============================================================
三、板块热度排行
============================================================

【最热板块 TOP5】
1. 电子 - 热度: 95分 (升温)
...

============================================================
四、策略总结
============================================================

【市场观点】
...

【核心机会】⭐
...

【主要风险】⚠️
...

【整体策略】
...

============================================================
本报告由智策AI系统自动生成并发送
仅供参考，不构成投资建议
============================================================
```

## 🎯 使用场景

### 场景1：盘前策略
- **设置时间**: 08:00
- **目的**: 盘前获取当日策略建议
- **用途**: 制定当日交易计划

### 场景2：盘后复盘
- **设置时间**: 16:00
- **目的**: 盘后总结当日行情
- **用途**: 评估当日决策，调整策略

### 场景3：晚间研究
- **设置时间**: 21:00
- **目的**: 晚间深度研究
- **用途**: 详细阅读分析，准备次日

## ⚠️ 注意事项

### 1. 邮件配置
- ✅ 使用邮箱授权码，不是登录密码
- ✅ 确保SMTP服务已开启
- ✅ 防火墙允许SMTP端口

### 2. 运行时间
- 建议避开交易繁忙时段（9:30-15:00）
- 盘前盘后数据更稳定
- 夜间运行可能获取不到当日数据

### 3. 分析时长
- 完整分析需要2-3分钟
- 数据获取30秒
- AI分析1.5-2分钟
- 邮件发送5秒

### 4. 数据时效
- 数据来源：AKShare（东方财富）
- 延迟：< 1分钟
- 盘后数据最完整

### 5. 网络要求
- 需要稳定的网络连接
- 能访问东方财富数据源
- SMTP端口未被阻止

## 🔧 故障排除

### 问题1：邮件配置不完整
**现象**: 配置检查显示红色叉号

**解决**:
1. 检查 `.env` 文件是否存在
2. 确认所有配置项都已填写
3. 重启应用使配置生效

### 问题2：测试邮件发送失败
**现象**: 点击测试邮件后提示失败

**解决**:
1. 确认邮箱密码是授权码而不是登录密码
2. 检查SMTP服务器地址是否正确
3. 确认SMTP服务已在邮箱中开启
4. 检查防火墙是否阻止了SMTP端口

### 问题3：定时任务未运行
**现象**: 到了设定时间但没有收到邮件

**解决**:
1. 检查定时任务状态是否为"运行中"
2. 查看系统日志是否有错误信息
3. 确认系统时间是否正确
4. 重启定时任务

### 问题4：数据获取失败
**现象**: 邮件中显示"数据获取失败"

**解决**:
1. 检查网络连接
2. 稍后重试（可能是数据源繁忙）
3. 避开交易高峰时段

### 问题5：AI分析失败
**现象**: 邮件中显示"AI分析失败"

**解决**:
1. 检查DeepSeek API配置
2. 确认API额度充足
3. 查看系统日志了解详细错误

## 📊 日志查看

### 控制台日志
运行 `streamlit run app.py` 后，在控制台可以看到：

```
[智策定时] 定时任务已启动，每天 09:00 运行
[智策定时] 后台线程已启动

# 到达定时时间后
============================================================
[智策定时] 开始定时分析 - 2024-01-15 09:00:00
============================================================
[智策定时] [1/3] 获取市场数据...
[智策定时] ✓ 数据获取成功
[智策定时] [2/3] AI智能体分析中...
[智策定时] ✓ 分析完成
[智策定时] [3/3] 发送邮件通知...
[智策定时] ✓ 邮件发送成功
============================================================
[智策定时] ✓ 定时分析完成！
============================================================
```

## 🎓 最佳实践

### 1. 时间设置
- **盘前用户**: 08:00-08:30（获取前一日数据+当日预判）
- **盘后用户**: 15:30-16:00（当日收盘数据）
- **研究用户**: 20:00-21:00（晚间详细研究）

### 2. 邮件管理
- 创建文件夹"智策报告"
- 设置邮件规则自动归档
- 定期清理过期报告

### 3. 报告使用
- 重点关注"潜力接力板块"
- 对比历史报告验证准确性
- 结合自己的判断决策

### 4. 配合使用
- 定时分析：宏观趋势把握
- 手动分析：重点板块深挖
- PDF导出：长期存档对比

## 🔄 更新说明

### v1.0.0 (当前版本)
- ✅ 基础定时任务功能
- ✅ 邮件通知发送
- ✅ 核心分析结果推送
- ✅ 手动触发功能
- ✅ 邮件配置检查

### 计划功能
- 🔲 多个定时任务（早中晚）
- 🔲 邮件包含图表
- 🔲 微信通知支持
- 🔲 短信通知支持
- 🔲 Webhook集成

## 📞 技术支持

如遇问题，请：
1. 查看本指南的故障排除章节
2. 检查系统日志获取详细错误
3. 确认邮件配置正确性
4. 测试网络连接稳定性

---

**智策定时分析** - 让AI每天为您工作！📊⏰

