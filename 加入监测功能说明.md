# 加入监测功能说明

## 功能概述

历史记录中的个股分析现在可以一键加入实时监测系统。系统会自动从最终投资决策中提取关键数据，快速创建监测任务。

## 功能特点

### 1. 智能数据提取

系统会自动从历史分析记录的最终投资决策中提取：
- **进场区间**：自动识别最低价和最高价
- **止盈位**：目标获利价位
- **止损位**：风险控制价位
- **投资评级**：买入/持有/卖出

### 2. 多格式支持

支持解析多种数据格式：

**进场区间格式**：
- `10.5-12.0`
- `10.5 - 12.0`
- `¥10.5-¥12.0`
- `10.5元-12.0元`
- `10.5~12.0`
- `10.5至12.0`

**止盈/止损格式**：
- `15.0`
- `¥15.0`
- `15.0元`
- `$15.0`

### 3. 重复检测

- 系统会自动检测股票是否已在监测列表中
- 如已存在，会给出警告提示
- 用户可以选择继续添加（创建重复监测项）或取消

### 4. 参数可调整

在加入监测前，用户可以：
- 确认或修改进场区间
- 调整止盈止损位
- 设置监测间隔（5-120分钟）
- 启用/禁用通知功能
- 修改投资评级

## 使用方法

### 方法1：从历史记录列表

1. 进入"历史记录"页面
2. 在任意分析记录的展开面板中，点击"➕ 监测"按钮
3. 系统会自动进入该记录的详情页面并显示加入监测对话框

### 方法2：从详情页面

1. 进入"历史记录"页面
2. 点击"👀 查看详情"按钮查看完整分析
3. 在详情页面底部点击"➕ 加入监测"按钮
4. 系统会显示加入监测对话框

### 使用对话框

1. **查看提取的数据**：系统会显示自动提取的进场区间、止盈、止损位等信息
2. **确认或修改参数**：在表单中调整监测参数
3. **提交**：点击"✅ 确认加入监测"按钮
4. **成功**：系统会自动添加到监测列表并立即更新一次价格

## 技术实现

### 关键函数

- `display_add_to_monitor_dialog(record)`：显示加入监测对话框
- 使用正则表达式 `re.findall()` 提取数字
- 调用 `monitor_db.add_monitored_stock()` 写入数据库
- 调用 `monitor_service.manual_update_stock()` 立即更新价格

### 数据流程

```
历史记录 → 提取final_decision → 解析关键数据 → 显示确认表单 → 写入监测数据库 → 立即更新价格
```

## 注意事项

1. **数据准确性**：系统会尽力解析各种格式的数据，但建议在提交前确认数据准确性
2. **重复监测**：同一只股票可以创建多个监测项（例如不同的进场区间）
3. **监测服务**：加入监测后，确保监测服务处于运行状态
4. **通知功能**：需要在 `.env` 中配置邮件参数才能接收通知

## 更新日志

### 2025-10-05
- ✅ 实现历史记录加入监测功能
- ✅ 支持多种数据格式自动解析
- ✅ 添加重复检测功能
- ✅ 优化用户界面和操作流程

